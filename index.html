<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark*Light - Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ±Ø© Ø¢Ù…Ù†Ø© Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„</title>
    <meta name="description" content="Ù…ÙˆÙ‚Ø¹ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ± ÙˆØ¢Ù…Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø§Ù…Ø© ÙˆØ®Ø§ØµØ© Ù…Ø¹ ØªØ´ÙÙŠØ± Ù…Ø­Ù„ÙŠ ÙˆÙˆØ§Ø¬Ù‡Ø© ØªÙŠØ±Ù…Ù†Ù„ Ù„ÙŠÙ†ÙƒØ³">
    <meta name="keywords" content="Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ±Ø©, Ø¯Ø±Ø¯Ø´Ø© Ø¢Ù…Ù†Ø©, Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„, Dark Light Chat, Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø±Ø¨ÙŠØ©, Ù…ÙˆÙ‚Ø¹ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¬Ù‡ÙˆÙ„, ØªØ´ÙÙŠØ± Ù…Ø­Ù„ÙŠ">
    <meta name="author" content="Dark*Light Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ -->
    <meta property="og:title" content="Dark*Light - Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ±Ø© Ø¢Ù…Ù†Ø©">
    <meta property="og:description" content="Ù…ÙˆÙ‚Ø¹ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ± ÙˆØ¢Ù…Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_SA">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Dark*Light - Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ±Ø© Ø¢Ù…Ù†Ø©">
    <meta name="twitter:description" content="Ù…ÙˆÙ‚Ø¹ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ± ÙˆØ¢Ù…Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .dark-mode {
            background-color: #000;
            color: #fff;
        }

        .light-mode {
            background-color: #fff;
            color: #000;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid;
            height: 60px;
        }

        .dark-mode .header {
            border-color: #333;
            background-color: #111;
        }

        .light-mode .header {
            border-color: #ddd;
            background-color: #f5f5f5;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: none;
            border: 1px solid;
            padding: 8px 15px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .dark-mode .control-btn {
            color: #fff;
            border-color: #555;
        }

        .dark-mode .control-btn:hover {
            background-color: #333;
        }

        .light-mode .control-btn {
            color: #000;
            border-color: #999;
        }

        .light-mode .control-btn:hover {
            background-color: #e0e0e0;
        }

        .user-id {
            font-weight: bold;
            color: #ff4444;
        }

        .connection-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 10px;
        }

        .connected {
            background-color: #44ff44;
            color: #000;
        }

        .disconnected {
            background-color: #ff4444;
            color: #fff;
        }

        .chat-container {
            height: calc(100vh - 120px);
            overflow-y: auto;
            padding: 20px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message {
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .timestamp {
            color: #888;
        }

        .username {
            font-weight: bold;
        }

        .my-username {
            color: #ff4444;
        }

        .other-username {
            color: #44ff44;
        }

        .encrypted-message {
            color: #666;
            font-style: italic;
        }

        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid;
        }

        .dark-mode .input-container {
            border-color: #333;
            background-color: #111;
        }

        .light-mode .input-container {
            border-color: #ddd;
            background-color: #f5f5f5;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt {
            color: #44ff44;
            font-weight: bold;
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-family: inherit;
            font-size: 14px;
            padding: 5px;
        }

        .dark-mode .message-input {
            color: #fff;
        }

        .light-mode .message-input {
            color: #000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
        }

        .dark-mode .modal-content {
            background-color: #222;
            border: 1px solid #555;
        }

        .light-mode .modal-content {
            background-color: #fff;
            border: 1px solid #ddd;
        }

        .modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }

        .user-list {
            margin-bottom: 20px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }

        .dark-mode .user-item:hover {
            background-color: #333;
        }

        .light-mode .user-item:hover {
            background-color: #f0f0f0;
        }

        .user-checkbox {
            margin-left: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: 1px solid;
            background: none;
            cursor: pointer;
            font-family: inherit;
            border-radius: 4px;
        }

        .online-count {
            font-size: 12px;
            color: #888;
        }

        .system-message {
            color: #888;
            font-style: italic;
            text-align: center;
            margin: 10px 0;
        }

        .welcome-section {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #44ff44;
        }

        .welcome-description {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .features-list {
            text-align: right;
            font-size: 12px;
            color: #888;
        }

        .features-list li {
            margin-bottom: 5px;
        }

        .success-message {
            background-color: #44ff44;
            color: #000;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .controls {
                gap: 8px;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .header {
                padding: 8px 15px;
            }
            
            .chat-container {
                padding: 15px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="header">
        <div class="logo">Dark*Light Terminal</div>
        <div class="controls">
            <span class="connection-status disconnected" id="connectionStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
            <span class="user-id" id="userId">ØªØ­Ù…ÙŠÙ„...</span>
            <span class="online-count" id="onlineCount">Ù…ØªØµÙ„: 0</span>
            <button class="control-btn" id="darkModeBtn">ğŸŒ“ Dark</button>
            <button class="control-btn" id="privateBtn">â˜… Ø®Ø§Øµ</button>
            <button class="control-btn" id="lightModeBtn">ğŸŒ Light</button>
        </div>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="success-message">
            <h3>ğŸ”¥ Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
            <p>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¢Ù† Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†!</p>
        </div>
        
        <div class="welcome-section">
            <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Dark*Light</div>
            <div class="welcome-description">
                Ù…ÙˆÙ‚Ø¹ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ± ÙˆØ¢Ù…Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
            </div>
            <ul class="features-list">
                <li>ğŸ”’ ØªØ´ÙÙŠØ± Ù…Ø­Ù„ÙŠ ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ</li>
                <li>ğŸ­ Ù‡ÙˆÙŠØ© Ù…Ø¬Ù‡ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
                <li>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø§Ù…Ø© ÙˆØ®Ø§ØµØ©</li>
                <li>ğŸ–¥ï¸ ÙˆØ§Ø¬Ù‡Ø© ØªÙŠØ±Ù…Ù†Ù„ Ù„ÙŠÙ†ÙƒØ³</li>
                <li>ğŸ“± ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</li>
                <li>ğŸ”¥ Ø¯Ø±Ø¯Ø´Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¹ Firebase</li>
                <li>âš¡ Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</li>
            </ul>
        </div>
    </div>

    <div class="input-container">
        <div class="input-row">
            <span class="prompt" id="promptText">guest@darklight:~$</span>
            <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." autocomplete="off">
        </div>
    </div>

    <!-- Modal Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø§Øµ -->
    <div class="modal" id="privateModal">
        <div class="modal-content">
            <div class="modal-title">Ø§Ø®ØªØ± Ù…Ù† ÙŠÙ…ÙƒÙ†Ù‡ Ø±Ø¤ÙŠØ© Ø±Ø³Ø§Ø¦Ù„Ùƒ</div>
            <div class="user-list" id="userList">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" id="applyPrivate">ØªØ·Ø¨ÙŠÙ‚</button>
                <button class="modal-btn" id="cancelPrivate">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="modal-btn" id="publicMode">Ø¹Ø§Ù… Ù„Ù„Ø¬Ù…ÙŠØ¹</button>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - ØªÙ… Ø§Ù„ØªÙƒÙˆÙŠÙ†!
        const firebaseConfig = {
            apiKey: "AIzaSyD3LkYqJE5Y_TR6A6UnajL304eyL4zO2lM",
            authDomain: "darklight-chat.firebaseapp.com",
            databaseURL: "https://darklight-chat-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "darklight-chat",
            storageBucket: "darklight-chat.firebasestorage.app",
            messagingSenderId: "425772939802",
            appId: "1:425772939802:web:5ba327426570f1b0d82fa3",
            measurementId: "G-HZ8Y56X7GV"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        class DarkLightChat {
            constructor() {
                this.userId = this.generateOrGetUserId();
                this.isDarkMode = true;
                this.isPrivateMode = false;
                this.selectedUsers = new Set();
                this.onlineUsers = new Map();
                this.messages = [];
                this.cryptoKey = null;
                this.isConnected = false;
                
                this.initializeElements();
                this.initializeCrypto();
                this.setupEventListeners();
                this.initializeFirebase();
                this.updateUI();
                this.addWelcomeMessage();
            }

            generateOrGetUserId() {
                let userId = localStorage.getItem('darklight_user_id');
                if (!userId) {
                    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                    const randomLetters = Array.from({length: 3}, () => 
                        letters[Math.floor(Math.random() * letters.length)]
                    ).join('');
                    const randomNumber = Math.floor(Math.random() * 900) + 100;
                    userId = `${randomLetters}#${randomNumber}`;
                    localStorage.setItem('darklight_user_id', userId);
                }
                return userId;
            }

            initializeElements() {
                this.elements = {
                    userId: document.getElementById('userId'),
                    onlineCount: document.getElementById('onlineCount'),
                    connectionStatus: document.getElementById('connectionStatus'),
                    chatContainer: document.getElementById('chatContainer'),
                    messageInput: document.getElementById('messageInput'),
                    promptText: document.getElementById('promptText'),
                    darkModeBtn: document.getElementById('darkModeBtn'),
                    lightModeBtn: document.getElementById('lightModeBtn'),
                    privateBtn: document.getElementById('privateBtn'),
                    privateModal: document.getElementById('privateModal'),
                    userList: document.getElementById('userList'),
                    applyPrivate: document.getElementById('applyPrivate'),
                    cancelPrivate: document.getElementById('cancelPrivate'),
                    publicMode: document.getElementById('publicMode')
                };
            }

            async initializeCrypto() {
                try {
                    this.cryptoKey = await window.crypto.subtle.generateKey(
                        { name: 'AES-GCM', length: 256 },
                        true,
                        ['encrypt', 'decrypt']
                    );
                } catch (error) {
                    console.warn('ØªØ´ÙÙŠØ± ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø§Ø¯ÙŠ');
                }
            }

            initializeFirebase() {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ…ØªØµÙ„
                this.userRef = database.ref(`users/${this.userId}`);
                this.messagesRef = database.ref('messages');
                this.onlineUsersRef = database.ref('users');

                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ…ØªØµÙ„
                this.userRef.set({
                    userId: this.userId,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP,
                    status: 'online'
                });

                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
                this.userRef.onDisconnect().remove();

                // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                this.messagesRef.limitToLast(50).on('child_added', (snapshot) => {
                    const messageData = snapshot.val();
                    if (messageData && messageData.userId !== this.userId) {
                        this.displayMessage(messageData);
                    }
                });

                // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
                this.onlineUsersRef.on('value', (snapshot) => {
                    const users = snapshot.val() || {};
                    this.onlineUsers.clear();
                    
                    Object.keys(users).forEach(userId => {
                        if (userId !== this.userId) {
                            this.onlineUsers.set(userId, users[userId]);
                        }
                    });
                    
                    this.updateOnlineCount();
                    this.updateConnectionStatus(true);
                });

                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
                database.ref('.info/connected').on('value', (snapshot) => {
                    this.updateConnectionStatus(snapshot.val());
                });

                // ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                this.elements.messageInput.disabled = false;
                this.elements.messageInput.placeholder = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...";
            }

            setupEventListeners() {
                this.elements.darkModeBtn.addEventListener('click', () => this.setTheme('dark'));
                this.elements.lightModeBtn.addEventListener('click', () => this.setTheme('light'));
                this.elements.privateBtn.addEventListener('click', () => this.showPrivateModal());
                
                this.elements.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });

                this.elements.applyPrivate.addEventListener('click', () => this.applyPrivateSettings());
                this.elements.cancelPrivate.addEventListener('click', () => this.hidePrivateModal());
                this.elements.publicMode.addEventListener('click', () => this.setPublicMode());

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡
                this.elements.privateModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.privateModal) {
                        this.hidePrivateModal();
                    }
                });
            }

            updateConnectionStatus(connected) {
                this.isConnected = connected;
                const statusElement = this.elements.connectionStatus;
                
                if (connected) {
                    statusElement.textContent = 'Ù…ØªØµÙ„';
                    statusElement.className = 'connection-status connected';
                } else {
                    statusElement.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                    statusElement.className = 'connection-status disconnected';
                }
            }

            setTheme(theme) {
                document.body.className = theme === 'dark' ? 'dark-mode' : 'light-mode';
                this.isDarkMode = theme === 'dark';
            }

            updateOnlineCount() {
                const count = this.onlineUsers.size + 1; // +1 Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                this.elements.onlineCount.textContent = `Ù…ØªØµÙ„: ${count}`;
            }

            updateUI() {
                this.elements.userId.textContent = this.userId;
                this.elements.promptText.textContent = `${this.userId.toLowerCase()}@darklight:~$`;
            }

            addWelcomeMessage() {
                setTimeout(() => {
                    this.addSystemMessage(`ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙˆÙŠØªÙƒ: ${this.userId}`);
                    this.addSystemMessage('ğŸ”¥ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†!');
                    this.addSystemMessage('ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "â˜… Ø®Ø§Øµ" Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø®Ø§ØµØ© Ù…Ø¹ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø­Ø¯Ø¯ÙŠÙ†');
                }, 1000);
            }

            showPrivateModal() {
                this.updateUserList();
                this.elements.privateModal.style.display = 'block';
            }

            hidePrivateModal() {
                this.elements.privateModal.style.display = 'none';
            }

            updateUserList() {
                const userList = this.elements.userList;
                userList.innerHTML = '';

                if (this.onlineUsers.size === 0) {
                    userList.innerHTML = '<div style="text-align: center; color: #888;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…ØªØµÙ„ÙŠÙ†</div>';
                    return;
                }

                this.onlineUsers.forEach((data, userId) => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'user-checkbox';
                    checkbox.checked = this.selectedUsers.has(userId);
                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            this.selectedUsers.add(userId);
                        } else {
                            this.selectedUsers.delete(userId);
                        }
                    });

                    const label = document.createElement('span');
                    label.textContent = userId;
                    label.className = 'other-username';

                    userItem.appendChild(checkbox);
                    userItem.appendChild(label);
                    userList.appendChild(userItem);
                });
            }

            applyPrivateSettings() {
                this.isPrivateMode = this.selectedUsers.size > 0;
                this.hidePrivateModal();
                
                const modeText = this.isPrivateMode ? 
                    `Ø®Ø§Øµ (${this.selectedUsers.size} Ù…Ø³ØªØ®Ø¯Ù…)` : 'Ø¹Ø§Ù…';
                this.addSystemMessage(`ØªÙ… ØªØºÙŠÙŠØ± ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¥Ù„Ù‰: ${modeText}`);
            }

            setPublicMode() {
                this.isPrivateMode = false;
                this.selectedUsers.clear();
                this.hidePrivateModal();
                this.addSystemMessage('ØªÙ… ØªØºÙŠÙŠØ± ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¥Ù„Ù‰: Ø¹Ø§Ù… Ù„Ù„Ø¬Ù…ÙŠØ¹');
            }

            async sendMessage() {
                const messageText = this.elements.messageInput.value.trim();
                if (!messageText) return;

                const timestamp = new Date().toLocaleTimeString('ar-SA', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                const messageData = {
                    id: Date.now(),
                    userId: this.userId,
                    timestamp: timestamp,
                    content: messageText,
                    isPrivate: this.isPrivateMode,
                    recipients: this.isPrivateMode ? Array.from(this.selectedUsers) : [],
                    serverTimestamp: firebase.database.ServerValue.TIMESTAMP
                };

                // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
                this.displayMessage(messageData);

                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø®Ø§Ø¯Ù…
                try {
                    await this.messagesRef.push(messageData);
                } catch (error) {
                    this.addSystemMessage('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© - ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„');
                }

                this.elements.messageInput.value = '';
            }

            displayMessage(messageData) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';

                const isMyMessage = messageData.userId === this.userId;
                const canSeeMessage = !messageData.isPrivate || 
                                    isMyMessage || 
                                    (messageData.recipients && messageData.recipients.includes(this.userId));

                let displayContent = canSeeMessage ? messageData.content : 'ğŸ”’ Ø±Ø³Ø§Ù„Ø© Ù…Ø´ÙØ±Ø© Ø®Ø§ØµØ©';
                const usernameClass = isMyMessage ? 'my-username' : 'other-username';
                const contentClass = canSeeMessage ? '' : 'encrypted-message';

                const privateIndicator = messageData.isPrivate ? ' ğŸ”’' : '';

                messageDiv.innerHTML = `
                    <span class="timestamp">[${messageData.timestamp}]</span>
                    <span class="username ${usernameClass}">&lt;${messageData.userId}&gt;</span>${privateIndicator}
                    <span class="${contentClass}"> ${displayContent}</span>
                `;

                this.elements.chatContainer.appendChild(messageDiv);
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
            }

            addSystemMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'system-message';
                messageDiv.textContent = `* ${text}`;
                this.elements.chatContainer.appendChild(messageDiv);
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', () => {
            new DarkLightChat();
        });

        // Ø¥Ø¶Ø§ÙØ© Schema.org Ù„Ù„Ù€ SEO
        const schema = {
            "@context": "https://schema.org",
            "@type": "WebApplication",
            "name": "Dark*Light Chat",
            "description": "Ù…ÙˆÙ‚Ø¹ Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙØ± ÙˆØ¢Ù…Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù„Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
            "applicationCategory": "CommunicationApplication",
            "operatingSystem": "Web Browser",
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            },
            "featureList": [
                "ØªØ´ÙÙŠØ± Ù…Ø­Ù„ÙŠ ÙƒØ§Ù…Ù„",
                "Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„",
                "ÙˆØ§Ø¬Ù‡Ø© ØªÙŠØ±Ù…Ù†Ù„ Ù„ÙŠÙ†ÙƒØ³",
                "Ø¯Ø±Ø¯Ø´Ø© Ø¹Ø§Ù…Ø© ÙˆØ®Ø§ØµØ©",
                "Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©",
                "Ø¯Ø±Ø¯Ø´Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ø¹ Firebase"
            ]
        };

        const script = document.createElement('script');
        script.type = 'application/ld+json';
        script.textContent = JSON.stringify(schema);
        document.head.appendChild(script);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e24daf96f45928',t:'MTc1NzcxMDUwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
