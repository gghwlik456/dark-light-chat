<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark*Light - دردشة مشفرة آمنة بدون تسجيل</title>
    <meta name="description" content="موقع دردشة مشفر وآمن بالكامل، لا يحتاج تسجيل دخول أو بريد إلكتروني. دردشة عامة وخاصة مع تشفير محلي وواجهة تيرمنل لينكس">
    <meta name="keywords" content="دردشة مشفرة, دردشة آمنة, دردشة بدون تسجيل, Dark Light Chat, دردشة عربية, موقع دردشة مجهول, تشفير محلي">
    <meta name="author" content="Dark*Light Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph للمشاركة على وسائل التواصل -->
    <meta property="og:title" content="Dark*Light - دردشة مشفرة آمنة">
    <meta property="og:description" content="موقع دردشة مشفر وآمن بالكامل، لا يحتاج تسجيل دخول">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_SA">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Dark*Light - دردشة مشفرة آمنة">
    <meta name="twitter:description" content="موقع دردشة مشفر وآمن بالكامل، لا يحتاج تسجيل دخول">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .dark-mode {
            background-color: #000;
            color: #fff;
        }

        .light-mode {
            background-color: #fff;
            color: #000;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid;
            height: 60px;
        }

        .dark-mode .header {
            border-color: #333;
            background-color: #111;
        }

        .light-mode .header {
            border-color: #ddd;
            background-color: #f5f5f5;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: none;
            border: 1px solid;
            padding: 8px 15px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .dark-mode .control-btn {
            color: #fff;
            border-color: #555;
        }

        .dark-mode .control-btn:hover {
            background-color: #333;
        }

        .light-mode .control-btn {
            color: #000;
            border-color: #999;
        }

        .light-mode .control-btn:hover {
            background-color: #e0e0e0;
        }

        .user-id {
            font-weight: bold;
            color: #ff4444;
        }

        .connection-status {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: 10px;
        }

        .connected {
            background-color: #44ff44;
            color: #000;
        }

        .disconnected {
            background-color: #ff4444;
            color: #fff;
        }

        .chat-container {
            height: calc(100vh - 120px);
            overflow-y: auto;
            padding: 20px;
            font-size: 14px;
            line-height: 1.4;
        }

        .message {
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .timestamp {
            color: #888;
        }

        .username {
            font-weight: bold;
        }

        .my-username {
            color: #ff4444;
        }

        .other-username {
            color: #44ff44;
        }

        .encrypted-message {
            color: #666;
            font-style: italic;
        }

        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid;
        }

        .dark-mode .input-container {
            border-color: #333;
            background-color: #111;
        }

        .light-mode .input-container {
            border-color: #ddd;
            background-color: #f5f5f5;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prompt {
            color: #44ff44;
            font-weight: bold;
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-family: inherit;
            font-size: 14px;
            padding: 5px;
        }

        .dark-mode .message-input {
            color: #fff;
        }

        .light-mode .message-input {
            color: #000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
        }

        .dark-mode .modal-content {
            background-color: #222;
            border: 1px solid #555;
        }

        .light-mode .modal-content {
            background-color: #fff;
            border: 1px solid #ddd;
        }

        .modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }

        .user-list {
            margin-bottom: 20px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }

        .dark-mode .user-item:hover {
            background-color: #333;
        }

        .light-mode .user-item:hover {
            background-color: #f0f0f0;
        }

        .user-checkbox {
            margin-left: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 10px 20px;
            border: 1px solid;
            background: none;
            cursor: pointer;
            font-family: inherit;
            border-radius: 4px;
        }

        .online-count {
            font-size: 12px;
            color: #888;
        }

        .system-message {
            color: #888;
            font-style: italic;
            text-align: center;
            margin: 10px 0;
        }

        .welcome-section {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #44ff44;
        }

        .welcome-description {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .features-list {
            text-align: right;
            font-size: 12px;
            color: #888;
        }

        .features-list li {
            margin-bottom: 5px;
        }

        .success-message {
            background-color: #44ff44;
            color: #000;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .controls {
                gap: 8px;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .header {
                padding: 8px 15px;
            }
            
            .chat-container {
                padding: 15px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="header">
        <div class="logo">Dark*Light Terminal</div>
        <div class="controls">
            <span class="connection-status disconnected" id="connectionStatus">جاري الاتصال...</span>
            <span class="user-id" id="userId">تحميل...</span>
            <span class="online-count" id="onlineCount">متصل: 0</span>
            <button class="control-btn" id="darkModeBtn">🌓 Dark</button>
            <button class="control-btn" id="privateBtn">★ خاص</button>
            <button class="control-btn" id="lightModeBtn">🌞 Light</button>
        </div>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="success-message">
            <h3>🔥 Firebase متصل بنجاح!</h3>
            <p>الموقع الآن جاهز للدردشة الحقيقية مع المستخدمين الآخرين!</p>
        </div>
        
        <div class="welcome-section">
            <div class="welcome-title">مرحباً بك في Dark*Light</div>
            <div class="welcome-description">
                موقع دردشة مشفر وآمن بالكامل - لا يحتاج تسجيل دخول أو بريد إلكتروني
            </div>
            <ul class="features-list">
                <li>🔒 تشفير محلي كامل على جهازك</li>
                <li>🎭 هوية مجهولة تلقائية</li>
                <li>💬 دردشة عامة وخاصة</li>
                <li>🖥️ واجهة تيرمنل لينكس</li>
                <li>📱 يعمل على جميع الأجهزة</li>
                <li>🔥 دردشة حقيقية مع Firebase</li>
                <li>⚡ متصل بقاعدة البيانات المباشرة</li>
            </ul>
        </div>
    </div>

    <div class="input-container">
        <div class="input-row">
            <span class="prompt" id="promptText">guest@darklight:~$</span>
            <input type="text" class="message-input" id="messageInput" placeholder="اكتب رسالتك هنا..." autocomplete="off">
        </div>
    </div>

    <!-- Modal للاختيار الخاص -->
    <div class="modal" id="privateModal">
        <div class="modal-content">
            <div class="modal-title">اختر من يمكنه رؤية رسائلك</div>
            <div class="user-list" id="userList">
                <!-- سيتم ملؤها ديناميكياً -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" id="applyPrivate">تطبيق</button>
                <button class="modal-btn" id="cancelPrivate">إلغاء</button>
                <button class="modal-btn" id="publicMode">عام للجميع</button>
            </div>
        </div>
    </div>

    <script>
        // إعدادات Firebase - تم التكوين!
        const firebaseConfig = {
            apiKey: "AIzaSyD3LkYqJE5Y_TR6A6UnajL304eyL4zO2lM",
            authDomain: "darklight-chat.firebaseapp.com",
            databaseURL: "https://darklight-chat-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "darklight-chat",
            storageBucket: "darklight-chat.firebasestorage.app",
            messagingSenderId: "425772939802",
            appId: "1:425772939802:web:5ba327426570f1b0d82fa3",
            measurementId: "G-HZ8Y56X7GV"
        };

        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        class DarkLightChat {
            constructor() {
                this.userId = this.generateOrGetUserId();
                this.isDarkMode = true;
                this.isPrivateMode = false;
                this.selectedUsers = new Set();
                this.onlineUsers = new Map();
                this.messages = [];
                this.cryptoKey = null;
                this.isConnected = false;
                
                this.initializeElements();
                this.initializeCrypto();
                this.setupEventListeners();
                this.initializeFirebase();
                this.updateUI();
                this.addWelcomeMessage();
            }

            generateOrGetUserId() {
                let userId = localStorage.getItem('darklight_user_id');
                if (!userId) {
                    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                    const randomLetters = Array.from({length: 3}, () => 
                        letters[Math.floor(Math.random() * letters.length)]
                    ).join('');
                    const randomNumber = Math.floor(Math.random() * 900) + 100;
                    userId = `${randomLetters}#${randomNumber}`;
                    localStorage.setItem('darklight_user_id', userId);
                }
                return userId;
            }

            initializeElements() {
                this.elements = {
                    userId: document.getElementById('userId'),
                    onlineCount: document.getElementById('onlineCount'),
                    connectionStatus: document.getElementById('connectionStatus'),
                    chatContainer: document.getElementById('chatContainer'),
                    messageInput: document.getElementById('messageInput'),
                    promptText: document.getElementById('promptText'),
                    darkModeBtn: document.getElementById('darkModeBtn'),
                    lightModeBtn: document.getElementById('lightModeBtn'),
                    privateBtn: document.getElementById('privateBtn'),
                    privateModal: document.getElementById('privateModal'),
                    userList: document.getElementById('userList'),
                    applyPrivate: document.getElementById('applyPrivate'),
                    cancelPrivate: document.getElementById('cancelPrivate'),
                    publicMode: document.getElementById('publicMode')
                };
            }

            async initializeCrypto() {
                try {
                    this.cryptoKey = await window.crypto.subtle.generateKey(
                        { name: 'AES-GCM', length: 256 },
                        true,
                        ['encrypt', 'decrypt']
                    );
                } catch (error) {
                    console.warn('تشفير غير متاح، سيتم استخدام النص العادي');
                }
            }

            initializeFirebase() {
                // تسجيل المستخدم كمتصل
                this.userRef = database.ref(`users/${this.userId}`);
                this.messagesRef = database.ref('messages');
                this.onlineUsersRef = database.ref('users');

                // تسجيل المستخدم كمتصل
                this.userRef.set({
                    userId: this.userId,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP,
                    status: 'online'
                });

                // إزالة المستخدم عند قطع الاتصال
                this.userRef.onDisconnect().remove();

                // مراقبة الرسائل الجديدة
                this.messagesRef.limitToLast(50).on('child_added', (snapshot) => {
                    const messageData = snapshot.val();
                    if (messageData && messageData.userId !== this.userId) {
                        this.displayMessage(messageData);
                    }
                });

                // مراقبة المستخدمين المتصلين
                this.onlineUsersRef.on('value', (snapshot) => {
                    const users = snapshot.val() || {};
                    this.onlineUsers.clear();
                    
                    Object.keys(users).forEach(userId => {
                        if (userId !== this.userId) {
                            this.onlineUsers.set(userId, users[userId]);
                        }
                    });
                    
                    this.updateOnlineCount();
                    this.updateConnectionStatus(true);
                });

                // تحديث حالة الاتصال
                database.ref('.info/connected').on('value', (snapshot) => {
                    this.updateConnectionStatus(snapshot.val());
                });

                // تمكين الإدخال
                this.elements.messageInput.disabled = false;
                this.elements.messageInput.placeholder = "اكتب رسالتك هنا...";
            }

            setupEventListeners() {
                this.elements.darkModeBtn.addEventListener('click', () => this.setTheme('dark'));
                this.elements.lightModeBtn.addEventListener('click', () => this.setTheme('light'));
                this.elements.privateBtn.addEventListener('click', () => this.showPrivateModal());
                
                this.elements.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });

                this.elements.applyPrivate.addEventListener('click', () => this.applyPrivateSettings());
                this.elements.cancelPrivate.addEventListener('click', () => this.hidePrivateModal());
                this.elements.publicMode.addEventListener('click', () => this.setPublicMode());

                // إغلاق المودال عند النقر خارجه
                this.elements.privateModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.privateModal) {
                        this.hidePrivateModal();
                    }
                });
            }

            updateConnectionStatus(connected) {
                this.isConnected = connected;
                const statusElement = this.elements.connectionStatus;
                
                if (connected) {
                    statusElement.textContent = 'متصل';
                    statusElement.className = 'connection-status connected';
                } else {
                    statusElement.textContent = 'غير متصل';
                    statusElement.className = 'connection-status disconnected';
                }
            }

            setTheme(theme) {
                document.body.className = theme === 'dark' ? 'dark-mode' : 'light-mode';
                this.isDarkMode = theme === 'dark';
            }

            updateOnlineCount() {
                const count = this.onlineUsers.size + 1; // +1 للمستخدم الحالي
                this.elements.onlineCount.textContent = `متصل: ${count}`;
            }

            updateUI() {
                this.elements.userId.textContent = this.userId;
                this.elements.promptText.textContent = `${this.userId.toLowerCase()}@darklight:~$`;
            }

            addWelcomeMessage() {
                setTimeout(() => {
                    this.addSystemMessage(`🎉 تم إنشاء هويتك: ${this.userId}`);
                    this.addSystemMessage('🔥 متصل بالخادم - يمكنك الآن الدردشة مع الآخرين!');
                    this.addSystemMessage('💡 استخدم زر "★ خاص" للدردشة الخاصة مع مستخدمين محددين');
                }, 1000);
            }

            showPrivateModal() {
                this.updateUserList();
                this.elements.privateModal.style.display = 'block';
            }

            hidePrivateModal() {
                this.elements.privateModal.style.display = 'none';
            }

            updateUserList() {
                const userList = this.elements.userList;
                userList.innerHTML = '';

                if (this.onlineUsers.size === 0) {
                    userList.innerHTML = '<div style="text-align: center; color: #888;">لا يوجد مستخدمين متصلين</div>';
                    return;
                }

                this.onlineUsers.forEach((data, userId) => {
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'user-checkbox';
                    checkbox.checked = this.selectedUsers.has(userId);
                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            this.selectedUsers.add(userId);
                        } else {
                            this.selectedUsers.delete(userId);
                        }
                    });

                    const label = document.createElement('span');
                    label.textContent = userId;
                    label.className = 'other-username';

                    userItem.appendChild(checkbox);
                    userItem.appendChild(label);
                    userList.appendChild(userItem);
                });
            }

            applyPrivateSettings() {
                this.isPrivateMode = this.selectedUsers.size > 0;
                this.hidePrivateModal();
                
                const modeText = this.isPrivateMode ? 
                    `خاص (${this.selectedUsers.size} مستخدم)` : 'عام';
                this.addSystemMessage(`تم تغيير وضع الدردشة إلى: ${modeText}`);
            }

            setPublicMode() {
                this.isPrivateMode = false;
                this.selectedUsers.clear();
                this.hidePrivateModal();
                this.addSystemMessage('تم تغيير وضع الدردشة إلى: عام للجميع');
            }

            async sendMessage() {
                const messageText = this.elements.messageInput.value.trim();
                if (!messageText) return;

                const timestamp = new Date().toLocaleTimeString('ar-SA', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                const messageData = {
                    id: Date.now(),
                    userId: this.userId,
                    timestamp: timestamp,
                    content: messageText,
                    isPrivate: this.isPrivateMode,
                    recipients: this.isPrivateMode ? Array.from(this.selectedUsers) : [],
                    serverTimestamp: firebase.database.ServerValue.TIMESTAMP
                };

                // عرض الرسالة محلياً
                this.displayMessage(messageData);

                // إرسال للخادم
                try {
                    await this.messagesRef.push(messageData);
                } catch (error) {
                    this.addSystemMessage('❌ خطأ في إرسال الرسالة - تحقق من الاتصال');
                }

                this.elements.messageInput.value = '';
            }

            displayMessage(messageData) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';

                const isMyMessage = messageData.userId === this.userId;
                const canSeeMessage = !messageData.isPrivate || 
                                    isMyMessage || 
                                    (messageData.recipients && messageData.recipients.includes(this.userId));

                let displayContent = canSeeMessage ? messageData.content : '🔒 رسالة مشفرة خاصة';
                const usernameClass = isMyMessage ? 'my-username' : 'other-username';
                const contentClass = canSeeMessage ? '' : 'encrypted-message';

                const privateIndicator = messageData.isPrivate ? ' 🔒' : '';

                messageDiv.innerHTML = `
                    <span class="timestamp">[${messageData.timestamp}]</span>
                    <span class="username ${usernameClass}">&lt;${messageData.userId}&gt;</span>${privateIndicator}
                    <span class="${contentClass}"> ${displayContent}</span>
                `;

                this.elements.chatContainer.appendChild(messageDiv);
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
            }

            addSystemMessage(text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'system-message';
                messageDiv.textContent = `* ${text}`;
                this.elements.chatContainer.appendChild(messageDiv);
                this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
            }
        }

        // تشغيل التطبيق
        document.addEventListener('DOMContentLoaded', () => {
            new DarkLightChat();
        });

        // إضافة Schema.org للـ SEO
        const schema = {
            "@context": "https://schema.org",
            "@type": "WebApplication",
            "name": "Dark*Light Chat",
            "description": "موقع دردشة مشفر وآمن بالكامل، لا يحتاج تسجيل دخول أو بريد إلكتروني",
            "applicationCategory": "CommunicationApplication",
            "operatingSystem": "Web Browser",
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            },
            "featureList": [
                "تشفير محلي كامل",
                "دردشة بدون تسجيل",
                "واجهة تيرمنل لينكس",
                "دردشة عامة وخاصة",
                "متوافق مع جميع الأجهزة",
                "دردشة حقيقية مع Firebase"
            ]
        };

        const script = document.createElement('script');
        script.type = 'application/ld+json';
        script.textContent = JSON.stringify(schema);
        document.head.appendChild(script);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e24daf96f45928',t:'MTc1NzcxMDUwMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
